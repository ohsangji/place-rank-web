<!DOCTYPE html>
<html lang="ko">
<<<<<<< HEAD
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì´ì§€ë³´ë“œ ê´€ë¦¬ì</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#2563EB;--blue2:#1D4ED8;--blue3:#60A5FA;--blue-50:#EFF6FF;
  --navy:#0F172A;--slate:#334155;--gray:#64748B;--gray2:#94A3B8;
  --gray-border:#E2E8F0;--gray-bg:#F8FAFC;--white:#FFFFFF;
  --green:#10B981;--red:#EF4444;--amber:#F59E0B;
  --font:'Noto Sans KR',sans-serif;--radius:12px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font);background:var(--gray-bg);color:var(--slate);min-height:100vh;-webkit-font-smoothing:antialiased}

/* â”€â”€ Header â”€â”€ */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:14px 24px;background:var(--white);border-bottom:1px solid var(--gray-border);position:sticky;top:0;z-index:100}
.hdr-left{display:flex;align-items:center;gap:12px}
.logo{font-size:18px;font-weight:800;color:var(--navy);letter-spacing:-0.03em}
.logo small{font-size:11px;font-weight:500;color:var(--gray);margin-left:4px}
.admin-badge{background:var(--red);color:white;font-size:10px;font-weight:700;padding:2px 8px;border-radius:20px}
.hdr-right{display:flex;align-items:center;gap:12px}
.hdr-btn{font-size:12px;font-weight:600;padding:6px 14px;border-radius:8px;border:1px solid var(--gray-border);background:var(--white);color:var(--gray);cursor:pointer;transition:all .2s}
.hdr-btn:hover{border-color:var(--blue);color:var(--blue)}
.hdr-btn.danger{color:var(--red);border-color:rgba(239,68,68,.2)}
.hdr-btn.danger:hover{background:rgba(239,68,68,.05);border-color:var(--red)}

/* â”€â”€ Stats â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;padding:24px;max-width:1200px;margin:0 auto}
.stat-card{background:var(--white);border:1px solid var(--gray-border);border-radius:var(--radius);padding:20px;transition:all .2s}
.stat-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.06)}
.stat-label{font-size:12px;font-weight:600;color:var(--gray);margin-bottom:4px}
.stat-num{font-size:28px;font-weight:800;color:var(--navy);letter-spacing:-0.03em}
.stat-num.blue{color:var(--blue)}
.stat-num.green{color:var(--green)}
.stat-num.amber{color:var(--amber)}
.stat-num.red{color:var(--red)}

/* â”€â”€ Content â”€â”€ */
.content{max-width:1200px;margin:0 auto;padding:0 24px 40px}
.panel{background:var(--white);border:1px solid var(--gray-border);border-radius:var(--radius);margin-bottom:20px;overflow:hidden}
.panel-head{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--gray-border)}
.panel-title{font-size:15px;font-weight:700;color:var(--navy);display:flex;align-items:center;gap:8px}
.panel-actions{display:flex;gap:8px}

/* â”€â”€ Table â”€â”€ */
.tbl{width:100%;border-collapse:collapse;font-size:13px}
.tbl th{text-align:left;padding:10px 16px;background:var(--gray-bg);color:var(--gray);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.03em;border-bottom:1px solid var(--gray-border)}
.tbl td{padding:10px 16px;border-bottom:1px solid var(--gray-border);color:var(--slate);vertical-align:middle}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:hover td{background:rgba(37,99,235,.02)}
.role-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700}
.role-admin{background:rgba(239,68,68,.08);color:var(--red)}
.role-user{background:rgba(37,99,235,.08);color:var(--blue)}
.status-approved{color:var(--green);font-weight:600}
.status-pending{color:var(--amber);font-weight:600}
.act-btn{font-size:11px;font-weight:600;padding:4px 10px;border-radius:6px;border:1px solid var(--gray-border);background:var(--white);cursor:pointer;transition:all .15s}
.act-btn:hover{border-color:var(--blue);color:var(--blue);background:var(--blue-50)}
.act-btn.del{color:var(--red)}
.act-btn.del:hover{border-color:var(--red);background:rgba(239,68,68,.05)}

/* â”€â”€ Modal â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:200;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:var(--white);border-radius:var(--radius);padding:28px;width:90%;max-width:440px;box-shadow:0 20px 60px rgba(0,0,0,.15)}
.modal-title{font-size:17px;font-weight:800;color:var(--navy);margin-bottom:20px}
.form-group{margin-bottom:14px}
.form-label{font-size:12px;font-weight:600;color:var(--slate);margin-bottom:4px;display:block}
.form-input{width:100%;padding:10px 14px;border:1px solid var(--gray-border);border-radius:8px;font-size:13px;font-family:var(--font);outline:none;transition:border .2s}
.form-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.form-select{width:100%;padding:10px 14px;border:1px solid var(--gray-border);border-radius:8px;font-size:13px;font-family:var(--font);outline:none;background:var(--white)}
.modal-btns{display:flex;gap:10px;margin-top:20px}
.btn{padding:10px 20px;border-radius:8px;font-size:13px;font-weight:700;font-family:var(--font);cursor:pointer;border:none;transition:all .2s}
.btn-primary{background:var(--blue);color:white}
.btn-primary:hover{background:var(--blue2)}
.btn-cancel{background:var(--gray-bg);color:var(--gray);border:1px solid var(--gray-border)}
.btn-cancel:hover{background:var(--gray-border)}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--blue);color:white;padding:10px 24px;border-radius:8px;font-size:13px;font-weight:600;z-index:300;display:none;box-shadow:0 8px 24px rgba(37,99,235,.3)}

/* â”€â”€ Search â”€â”€ */
.search-bar{padding:4px;display:flex;gap:8px}
.search-input{padding:6px 12px;border:1px solid var(--gray-border);border-radius:8px;font-size:12px;font-family:var(--font);outline:none;width:200px}
.search-input:focus{border-color:var(--blue)}

/* â”€â”€ Dark Mode â”€â”€ */
[data-theme="dark"]{--navy:#E0E4EA;--slate:#B8C2D0;--gray:#7A8599;--gray2:#5A6370;--gray-border:rgba(255,255,255,.08);--gray-bg:#0C0C18;--white:#1C1C2E;--blue-50:rgba(37,99,235,.06)}
[data-theme="dark"] body{background:#0C0C18;color:#B8C2D0}
[data-theme="dark"] .hdr{background:#141422;border-color:rgba(255,255,255,.05)}
[data-theme="dark"] .logo{color:#E0E4EA}
[data-theme="dark"] .stat-card{background:#1C1C2E;border-color:rgba(255,255,255,.06)}
[data-theme="dark"] .stat-num{color:#E0E4EA}
[data-theme="dark"] .panel{background:#1C1C2E;border-color:rgba(255,255,255,.06)}
[data-theme="dark"] .panel-head{border-color:rgba(255,255,255,.06)}
[data-theme="dark"] .tbl th{background:#141422;color:#7A8599;border-color:rgba(255,255,255,.04)}
[data-theme="dark"] .tbl td{color:#B8C2D0;border-color:rgba(255,255,255,.04)}
[data-theme="dark"] .tbl tr:hover td{background:rgba(37,99,235,.04)}
[data-theme="dark"] .modal{background:#1C1C2E}
[data-theme="dark"] .form-input,.form-select{background:#141422;border-color:rgba(255,255,255,.08);color:#D0D5DD}
[data-theme="dark"] .form-input:focus{border-color:var(--blue)}
[data-theme="dark"] .act-btn{background:#141422;border-color:rgba(255,255,255,.08);color:#A0A8B4}
[data-theme="dark"] .hdr-btn{background:#141422;border-color:rgba(255,255,255,.08);color:#A0A8B4}
[data-theme="dark"] .search-input{background:#141422;border-color:rgba(255,255,255,.08);color:#D0D5DD}

.theme-toggle{position:fixed;bottom:24px;right:24px;width:48px;height:48px;border-radius:50%;border:1px solid var(--gray-border);background:var(--white);color:var(--navy);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px;box-shadow:0 4px 12px rgba(0,0,0,.1);transition:all .3s;z-index:998}
.theme-toggle:hover{transform:scale(1.1)}
[data-theme="dark"] .theme-toggle{background:#1C1C2E;color:#E0E4EA;border-color:rgba(255,255,255,.08)}

@media(max-width:768px){
  .stats{grid-template-columns:repeat(2,1fr);padding:16px}
  .content{padding:0 16px 40px}
}
</style>
</head>
<body>

<header class="hdr">
  <div class="hdr-left">
    <div class="logo">ì´ì§€ë³´ë“œ<small>Admin</small></div>
    <span class="admin-badge">ê´€ë¦¬ì</span>
  </div>
  <div class="hdr-right">
    <span id="adminName" style="font-size:12px;font-weight:600;color:var(--gray)"></span>
    <button class="hdr-btn" onclick="location.href='/app'">ì•±ìœ¼ë¡œ ì´ë™</button>
    <button class="hdr-btn danger" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<div class="stats" id="statsBar">
  <div class="stat-card"><div class="stat-label">ì „ì²´ íšŒì›</div><div class="stat-num blue" id="statTotal">0</div></div>
  <div class="stat-card"><div class="stat-label">ìŠ¹ì¸ ì™„ë£Œ</div><div class="stat-num green" id="statApproved">0</div></div>
  <div class="stat-card"><div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div><div class="stat-num amber" id="statPending">0</div></div>
  <div class="stat-card"><div class="stat-label">ê´€ë¦¬ì</div><div class="stat-num red" id="statAdmin">0</div></div>
</div>

<div class="content">
  <div class="panel">
    <div class="panel-head">
      <div class="panel-title">ğŸ‘¥ íšŒì› ê´€ë¦¬</div>
      <div class="panel-actions">
        <div class="search-bar">
          <input class="search-input" id="searchInput" placeholder="ì´ë¦„/ì•„ì´ë”” ê²€ìƒ‰..." oninput="renderTable()">
        </div>
        <button class="hdr-btn" style="color:var(--blue);border-color:rgba(37,99,235,.3)" onclick="openModal('add')">+ íšŒì› ì¶”ê°€</button>
      </div>
    </div>
    <table class="tbl">
      <thead>
        <tr>
          <th>#</th>
          <th>ì•„ì´ë””</th>
          <th>ì´ë¦„</th>
          <th>ì´ë©”ì¼</th>
          <th>íšŒì‚¬</th>
          <th>ì „í™”ë²ˆí˜¸</th>
          <th>íšŒì›ìœ í˜•</th>
          <th>ì—­í• </th>
          <th>ìƒíƒœ</th>
          <th>ê°€ì…ì¼</th>
          <th>ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
    <div id="emptyMsg" style="padding:40px;text-align:center;font-size:13px;color:var(--gray);display:none">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>
</div>

<!-- íšŒì› ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="userModal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-title" id="modalTitle">íšŒì› ì¶”ê°€</div>
    <input type="hidden" id="editIdx" value="-1">
    <div class="form-group"><label class="form-label">ì•„ì´ë”” *</label><input class="form-input" id="mUsername"></div>
    <div class="form-group"><label class="form-label">ì´ë¦„ *</label><input class="form-input" id="mName"></div>
    <div class="form-group"><label class="form-label">ì´ë©”ì¼</label><input class="form-input" id="mEmail" type="email"></div>
    <div class="form-group"><label class="form-label">íšŒì‚¬ëª…</label><input class="form-input" id="mCompany"></div>
    <div class="form-group"><label class="form-label">ì „í™”ë²ˆí˜¸</label><input class="form-input" id="mPhone"></div>
    <div class="form-group"><label class="form-label">ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì • ì‹œ ë¹„ì›Œë‘ë©´ ìœ ì§€)</label><input class="form-input" id="mPassword" type="password" placeholder="8ì ì´ìƒ"></div>
    <div class="form-group" style="display:flex;gap:12px">
      <div style="flex:1"><label class="form-label">ì—­í• </label>
        <select class="form-select" id="mRole"><option value="user">ì¼ë°˜íšŒì›</option><option value="admin">ê´€ë¦¬ì</option></select>
      </div>
      <div style="flex:1"><label class="form-label">ìŠ¹ì¸ ìƒíƒœ</label>
        <select class="form-select" id="mApproved"><option value="true">ìŠ¹ì¸</option><option value="false">ëŒ€ê¸°</option></select>
      </div>
    </div>
    <div class="modal-btns">
      <button class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveUser()">ì €ì¥</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">ğŸŒ™</div>

<script>
let users = [];

// â”€â”€ Auth Check â”€â”€
async function checkAdmin(){
  const r = await fetch('/api/auth/check');
  const d = await r.json();
  if(!d.loggedIn) { location.href='/login'; return; }
  document.getElementById('adminName').textContent = 'ğŸ‘¤ ' + d.username;
  // admin ê¶Œí•œ ì²´í¬
  const r2 = await fetch('/api/admin/users');
  if(!r2.ok) { showToast('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤'); setTimeout(()=>location.href='/app',1500); return; }
  users = await r2.json();
  renderStats();
  renderTable();
}

function renderStats(){
  document.getElementById('statTotal').textContent = users.length;
  document.getElementById('statApproved').textContent = users.filter(u=>u.approved).length;
  document.getElementById('statPending').textContent = users.filter(u=>!u.approved).length;
  document.getElementById('statAdmin').textContent = users.filter(u=>u.role==='admin').length;
}

function renderTable(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  const filtered = q ? users.filter(u => (u.username||'').toLowerCase().includes(q) || (u.name||'').toLowerCase().includes(q)) : users;
  const tb = document.getElementById('userTable');
  document.getElementById('emptyMsg').style.display = filtered.length ? 'none' : 'block';
  tb.innerHTML = filtered.map((u,i) => {
    const idx = users.indexOf(u);
    return `<tr>
      <td>${idx+1}</td>
      <td><b>${u.username}</b></td>
      <td>${u.name||'-'}</td>
      <td>${u.email||'-'}</td>
      <td>${u.company||'-'}</td>
      <td>${u.phone||'-'}</td>
      <td>${u.memberType==='individual'?'ê°œì¸ì‚¬ì—…ì':u.memberType==='corporate'?'ë²•ì¸ì‚¬ì—…ì':'ì¼ë°˜íšŒì›'}</td>
      <td><span class="role-badge ${u.role==='admin'?'role-admin':'role-user'}">${u.role==='admin'?'ê´€ë¦¬ì':'íšŒì›'}</span></td>
      <td><span class="${u.approved?'status-approved':'status-pending'}">${u.approved?'âœ… ìŠ¹ì¸':'â³ ëŒ€ê¸°'}</span></td>
      <td>${u.createdAt||'-'}</td>
      <td style="white-space:nowrap">
        <button class="act-btn" onclick="openModal('edit',${idx})">ìˆ˜ì •</button>
        ${u.approved?'':`<button class="act-btn" style="color:var(--green)" onclick="approveUser(${idx})">ìŠ¹ì¸</button>`}
        ${u.role!=='admin'?`<button class="act-btn del" onclick="deleteUser(${idx})">ì‚­ì œ</button>`:''}
      </td>
    </tr>`;
  }).join('');
}

// â”€â”€ Modal â”€â”€
function openModal(mode, idx){
  document.getElementById('editIdx').value = idx ?? -1;
  document.getElementById('modalTitle').textContent = mode==='add' ? 'íšŒì› ì¶”ê°€' : 'íšŒì› ìˆ˜ì •';
  if(mode==='edit' && idx >= 0){
    const u = users[idx];
    document.getElementById('mUsername').value = u.username||'';
    document.getElementById('mName').value = u.name||'';
    document.getElementById('mEmail').value = u.email||'';
    document.getElementById('mCompany').value = u.company||'';
    document.getElementById('mPhone').value = u.phone||'';
    document.getElementById('mPassword').value = '';
    document.getElementById('mRole').value = u.role||'user';
    document.getElementById('mApproved').value = u.approved ? 'true' : 'false';
    document.getElementById('mUsername').readOnly = true;
  } else {
    ['mUsername','mName','mEmail','mCompany','mPhone','mPassword'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('mRole').value = 'user';
    document.getElementById('mApproved').value = 'true';
    document.getElementById('mUsername').readOnly = false;
  }
  document.getElementById('userModal').classList.add('open');
}
function closeModal(){ document.getElementById('userModal').classList.remove('open'); }

async function saveUser(){
  const idx = parseInt(document.getElementById('editIdx').value);
  const data = {
    username: document.getElementById('mUsername').value.trim(),
    name: document.getElementById('mName').value.trim(),
    email: document.getElementById('mEmail').value.trim(),
    company: document.getElementById('mCompany').value.trim(),
    phone: document.getElementById('mPhone').value.trim(),
    password: document.getElementById('mPassword').value,
    role: document.getElementById('mRole').value,
    approved: document.getElementById('mApproved').value === 'true'
  };
  if(!data.username || !data.name){ showToast('ì•„ì´ë””ì™€ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤'); return; }
  if(idx < 0 && !data.password){ showToast('ìƒˆ íšŒì›ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const url = idx >= 0 ? `/api/admin/users/${idx}` : '/api/admin/users';
  const method = idx >= 0 ? 'PUT' : 'POST';
  const r = await fetch(url, { method, headers:{'Content-Type':'application/json'}, body:JSON.stringify(data) });
  const d = await r.json();
  if(d.success){ showToast(idx>=0?'ìˆ˜ì • ì™„ë£Œ':'ì¶”ê°€ ì™„ë£Œ'); closeModal(); await refreshUsers(); }
  else { showToast(d.message||'ì˜¤ë¥˜ ë°œìƒ'); }
}

async function approveUser(idx){
  const r = await fetch(`/api/admin/users/${idx}/approve`, { method:'POST' });
  const d = await r.json();
  if(d.success){ showToast('ìŠ¹ì¸ ì™„ë£Œ'); await refreshUsers(); }
}

async function deleteUser(idx){
  if(!confirm(`${users[idx].username} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  const r = await fetch(`/api/admin/users/${idx}`, { method:'DELETE' });
  const d = await r.json();
  if(d.success){ showToast('ì‚­ì œ ì™„ë£Œ'); await refreshUsers(); }
}

async function refreshUsers(){
  const r = await fetch('/api/admin/users');
  users = await r.json();
  renderStats();
  renderTable();
}

// â”€â”€ Utils â”€â”€
async function doLogout(){
  await fetch('/api/auth/logout',{method:'POST'});
  location.href='/login';
}
function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.style.display='block';
  setTimeout(()=>t.style.display='none',2500);
}
function toggleTheme(){const h=document.documentElement,d=h.getAttribute('data-theme')==='dark';h.setAttribute('data-theme',d?'light':'dark');document.getElementById('themeToggle').textContent=d?'ğŸŒ™':'â˜€ï¸';localStorage.setItem('theme',d?'light':'dark')}
(function(){const t=localStorage.getItem('theme');if(t==='dark'){document.documentElement.setAttribute('data-theme','dark');document.getElementById('themeToggle').textContent='â˜€ï¸'}})();

checkAdmin();
</script>
</body>
</html>
=======
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ì§€ë³´ë“œ ê´€ë¦¬ì</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans KR',sans-serif;background:#f0f2f5;min-height:100vh}
    #loginWrap{display:flex;align-items:center;justify-content:center;min-height:100vh}
    .login-box{background:#fff;padding:40px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);width:360px}
    .login-box h2{text-align:center;margin-bottom:28px;color:#1a1a2e;font-size:22px}
    .login-box input{width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:8px;font-size:15px;margin-bottom:14px;outline:none}
    .login-box input:focus{border-color:#4f8ef7}
    .login-box button{width:100%;padding:13px;background:#4f8ef7;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;font-weight:600}
    .login-box button:hover{background:#3a7ae0}
    .err{color:#e53e3e;font-size:13px;margin-top:8px;text-align:center}
    #adminWrap{display:none;padding:24px}
    .header{background:#fff;padding:16px 24px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .header h1{font-size:20px;color:#1a1a2e}
    .logout-btn{padding:8px 18px;background:#ff5a5a;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px}
    .stats{display:flex;gap:16px;margin-bottom:20px}
    .stat-card{background:#fff;padding:20px 28px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);flex:1;text-align:center}
    .stat-card .num{font-size:32px;font-weight:700;color:#4f8ef7}
    .stat-card .label{font-size:13px;color:#888;margin-top:4px}
    .table-wrap{background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden}
    .table-header{padding:16px 20px;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}
    .table-header span{font-weight:600;color:#1a1a2e}
    .search-input{padding:8px 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;width:220px;outline:none}
    table{width:100%;border-collapse:collapse}
    th{background:#fafbfc;padding:12px 14px;font-size:13px;color:#666;font-weight:600;text-align:left;border-bottom:1px solid #eee}
    td{padding:12px 14px;font-size:14px;color:#333;border-bottom:1px solid #f5f5f5;vertical-align:middle}
    tr:hover td{background:#f9fbff}
    .badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600}
    .badge-admin{background:#fff0e6;color:#e07a2f}
    .badge-general{background:#e8f4fd;color:#2b7ec1}
    .doc-btn{padding:5px 12px;background:#4f8ef7;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:12px}
    .doc-btn:hover{background:#3a7ae0}
    .no-doc{color:#bbb;font-size:13px}
    .refresh-btn{padding:8px 16px;background:#4f8ef7;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px}
    </style>
  </head>
  <body>
    <div id="loginWrap">
        <div class="login-box">
              <h2>ğŸ” ì´ì§€ë³´ë“œ ê´€ë¦¬ì</h2>
            <input type="text" id="loginId" placeholder="ì•„ì´ë””" />
            <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" />
            <button onclick="doLogin()">ë¡œê·¸ì¸</button>button>
            <div class="err" id="loginErr"></div>div>
        </div>div>
    </div>div>
  
  <div id="adminWrap">
    <div class="header">
        <h1>ğŸ“‹ ì´ì§€ë³´ë“œ íšŒì› ê´€ë¦¬</h1>
        <button class="logout-btn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>button>
    </div>div>
    <div class="stats">
        <div class="stat-card"><div class="num" id="totalCount">0</div>div><div class="label">ì „ì²´ íšŒì›</div>div></div>div>
        <div class="stat-card"><div class="num" id="generalCount">0</div>div><div class="label">ì¼ë°˜ íšŒì›</div>div></div>div>
        <div class="stat-card"><div class="num" id="bizCount">0</div>div><div class="label">ì‚¬ì—…ì ë“±ë¡ íšŒì›</div>div></div>div>
    </div>div>
    <div class="table-wrap">
        <div class="table-header">
              <span>íšŒì› ëª©ë¡</span>
              <div style="display:flex;gap:10px">
                      <input class="search-input" id="searchInput" placeholder="ì´ë¦„, ì—°ë½ì²˜, íšŒì‚¬ëª… ê²€ìƒ‰..." oninput="renderTable()" />
                      <button class="refresh-btn" onclick="loadUsers()">ìƒˆë¡œê³ ì¹¨</button>button>
              </div>div>
        </div>div>
        <div style="overflow-x:auto">
            <table>
                    <thead>
                              <tr>
                                          <th>No</th><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>íšŒì‚¬ëª…</th>
                              <th>ì—°ë½ì²˜</th><th>ì´ë©”ì¼</th><th>êµ¬ë¶„</th><th>ê°€ì…ì¼</th><th>ì‚¬ì—…ìë“±ë¡ì¦</th>
                              </tr>
                    </thead>
                  <tbody id="userTbody"></tbody>tbody>
            </table>
        </div>div>
    </div>div>
  </div>div>
  
  <script>
    let TOKEN = localStorage.getItem('adminToken') || '';
    let ALL_USERS = [];

    async function doLogin() {
        const id = document.getElementById('loginId').value.trim();
        const pw = document.getElementById('loginPw').value;
        const r = await fetch('/api/admin/login', {
              method:'POST', headers:{'Content-Type':'application/json'},
              body: JSON.stringify({ username: id, password: pw })
        });
        const d = await r.json();
        if (d.success) {
              TOKEN = d.token;
              localStorage.setItem('adminToken', TOKEN);
              showAdmin();
        } else {
              document.getElementById('loginErr').textContent = d.message;
        }
    }

    function doLogout() {
        localStorage.removeItem('adminToken');
        TOKEN = '';
        document.getElementById('loginWrap').style.display = 'flex';
        document.getElementById('adminWrap').style.display = 'none';
    }

    async function showAdmin() {
        document.getElementById('loginWrap').style.display = 'none';
        document.getElementById('adminWrap').style.display = 'block';
        await loadUsers();
    }

    async function loadUsers() {
        const r = await fetch('/api/admin/users', { headers:{'x-admin-token': TOKEN} });
        if (r.status === 401) { doLogout(); return; }
        const d = await r.json();
        ALL_USERS = (d.users || []).filter(u => u.username !== 'admin');
        updateStats();
        renderTable();
    }

    function updateStats() {
        document.getElementById('totalCount').textContent = ALL_USERS.length;
        document.getElementById('generalCount').textContent = ALL_USERS.filter(u => u.memberType !== 'admin').length;
        document.getElementById('bizCount').textContent = ALL_USERS.filter(u => u.bizDoc).length;
    }

    function renderTable() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const filtered = ALL_USERS.filter(u =>
              (u.name||'').toLowerCase().includes(q) ||
              (u.phone||'').includes(q) ||
              (u.company||'').toLowerCase().includes(q) ||
              (u.email||'').toLowerCase().includes(q)
                                            );
        const tbody = document.getElementById('userTbody');
        if (filtered.length === 0) {
              tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:30px;color:#bbb">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
              return;
        }
        tbody.innerHTML = filtered.map((u, i) => `
            <tr>
                  <td>${i+1}</td>
                        <td><strong>${u.name||'-'}</strong></td>
                              <td>${u.username}</td>
                                    <td>${u.company||'-'}</td>
                                          <td>${u.phone||'-'}</td>
                                                <td>${u.email||'-'}</td>
                                                      <td><span class="badge ${u.memberType==='admin'?'badge-admin':'badge-general'}">${u.memberType==='admin'?'ê´€ë¦¬ì':'ì¼ë°˜'}</span></td>
                                                            <td>${u.createdAt||'-'}</td>
                                                                  <td>${u.bizDoc
                                                                                ? `<button class="doc-btn" onclick="downloadDoc('${u.bizDoc}','${u.name}')">ğŸ“„ ë‹¤ìš´ë¡œë“œ</button>`
                                                                                : '<span class="no-doc">ì—†ìŒ</span>'}</td>
                                                                                    </tr>
                                                                                      `).join('');
    }

    async function downloadDoc(filename, name) {
        const r = await fetch('/api/admin/bizdoc/'+filename, { headers:{'x-admin-token': TOKEN} });
        if (!r.ok) { alert('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
        const blob = await r.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = name+'_ì‚¬ì—…ìë“±ë¡ì¦'+filename.substring(filename.lastIndexOf('.'));
        a.click(); URL.revokeObjectURL(url);
    }

    // ìë™ ë¡œê·¸ì¸ ì‹œë„
    if (TOKEN) { showAdmin(); }

    document.getElementById('loginPw').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
    document.getElementById('loginId').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
  </script>
  </body>
</html>html>
  </script></th></th>
                              </tr>
                    </thead>
            </table></span></h1></h2>
  </body>
  </style></title>
  </head>
>>>>>>> caf37222a583f73f1572d395e9bcad5e13d5dca8
